# ----- base image -----
FROM python:3.11-slim

# System deps you need (chromium etc. for your scraper)
RUN apt-get update && apt-get install -y --no-install-recommends \
    chromium \
    fonts-liberation \
    libnss3 libxss1 libasound2 libxshmfence1 libx11-6 libxcomposite1 \
    libxdamage1 libxrandr2 libgbm1 libgtk-3-0 ca-certificates curl git \
  && rm -rf /var/lib/apt/lists/*

# Workdir
WORKDIR /app

# --- Python deps ---
# since Root Directory is backend/, requirements.txt is at ./requirements.txt
COPY requirements.txt /app/requirements.txt
RUN pip install --upgrade pip && pip install -r /app/requirements.txt

# --- App code ---
COPY . /app/

# dirs used by your app
RUN mkdir -p /app/uploads /app/generated_resumes

# Do NOT set a fixed port here; if you want a fallback, use it in the CMD string.
# EXPOSE is optional on Render, harmless if present
EXPOSE 8000

# Use shell form so $PORT expands on Render.
# The :-8000 gives you a sensible local fallback if PORT isnâ€™t set.
CMD ["sh","-c","gunicorn app:app --bind 0.0.0.0:${PORT:-8000} --timeout 180 --workers 2 --threads 4"]