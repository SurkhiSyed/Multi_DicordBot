# ----- base image -----
FROM python:3.11-slim

# System deps you need (chromium etc. for your scraper)
RUN apt-get update && apt-get install -y --no-install-recommends \
    chromium \
    fonts-liberation \
    libnss3 libxss1 libasound2 libxshmfence1 libx11-6 libxcomposite1 \
    libxdamage1 libxrandr2 libgbm1 libgtk-3-0 ca-certificates curl git \
  && rm -rf /var/lib/apt/lists/*

# Workdir
WORKDIR /app

# --- Python deps ---
# since Root Directory is backend/, requirements.txt is at ./requirements.txt
COPY requirements.txt /app/requirements.txt
RUN pip install --upgrade pip && pip install -r /app/requirements.txt

# --- App code ---
COPY . /app/

# dirs used by your app
RUN mkdir -p /app/uploads /app/generated_resumes

# runtime env
ENV PYTHONUNBUFFERED=1
ENV PORT=8000
EXPOSE 8000

# start Flask with gunicorn
# (if you use uvicorn/ASGI, swap the command accordingly)
CMD ["gunicorn", "-w", "2", "-b", "0.0.0.0:8000", "app:app"]
